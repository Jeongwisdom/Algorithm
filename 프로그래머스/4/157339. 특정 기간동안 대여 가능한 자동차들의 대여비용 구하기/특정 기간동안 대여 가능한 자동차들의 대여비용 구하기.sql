SELECT C.CAR_ID, C.CAR_TYPE, ROUND(C.DAILY_FEE * 30 * (100 - P.DISCOUNT_RATE) / 100) FEE FROM CAR_RENTAL_COMPANY_CAR C 
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN P ON P.CAR_TYPE = C.CAR_TYPE AND DURATION_TYPE = '30일 이상' 
WHERE C.CAR_TYPE IN ('세단', 'SUV') AND C.CAR_ID NOT IN (SELECT CAR_ID FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY WHERE END_DATE BETWEEN '2022-11-01' AND '2022-11-30' OR START_DATE BETWEEN '2022-11-01' AND '2022-11-30' OR '2022-11-01' BETWEEN START_DATE AND END_DATE OR '2022-11-30' BETWEEN START_DATE AND END_DATE)
HAVING FEE BETWEEN 500000 AND 2000000 
ORDER BY FEE DESC, CAR_TYPE, CAR_ID;